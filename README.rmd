---
title: "sada"
output:
  md_document:
    variant: gfm
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE
)
```


# sada

R package for implementing SADA: Safe and Adaptive Aggregation of Multiple
Black-Box Predictions in Semi-Supervised Learning.


## Installation

```{r install, eval=FALSE}
install.packages("devtools")
devtools::install_github("jw-shan/sada")
```

```{r setup_sada, include=FALSE}
library(sada)
```



## Example: Implement SADA-OLS with two predictions

```{r example}
## Sample sizes
n <- 100    # labeled
m <- 500   # unlabeled

## True coefficients: intercept and slopes
beta_true <- c(1, 2, -1)

## Covariates for labeled and unlabeled data (without intercept column)
X_labeled <- cbind(rnorm(n), rnorm(n))
X_unlabeled <- cbind(rnorm(m), rnorm(m))

## Labeled outcomes generated from a linear model with noise
linpred_labeled <- beta_true[1] +
  as.numeric(X_labeled %*% beta_true[-1])
Y <- linpred_labeled + rnorm(n, sd = 1)

## Build full covariate matrix (labeled + unlabeled)
X_full <- rbind(X_labeled, X_unlabeled)
N <- n + m

## Underlying linear predictor for all data
linpred_full <- beta_true[1] +
  as.numeric(X_full %*% beta_true[-1])

## Two black box prediction sources with different noise levels
Yhat1_full <- linpred_full + rnorm(N, sd = 0.5)
Yhat2_full <- linpred_full + rnorm(N, sd = 1.5)

## Split into labeled and unlabeled prediction matrices
Yhat_labeled <- cbind(Yhat1_full[1:n], Yhat2_full[1:n])
Yhat_unlabeled <- cbind(Yhat1_full[(n + 1):N], Yhat2_full[(n + 1):N])

## Fit SADA OLS estimator
fit_sada <- sada_ols(
  Y = Y,
  Yhat_labeled = Yhat_labeled,
  Yhat_unlabeled = Yhat_unlabeled,
  X_labeled = X_labeled,
  X_unlabeled = X_unlabeled
)

## Coefficient estimates from SADA (including intercept)
fit_sada$est

## Standard errors and confidence intervals from SADA
fit_sada$sd
fit_sada$ci

## A regression style summary, similar to summary(lm)
summary(fit_sada)

## Extract the covariance matrix via the vcov method
vcov(fit_sada)

## Compare with ordinary OLS using labeled data only
## We fit lm on the same covariates, without using any unlabeled data
df_labeled <- data.frame(
  Y = Y,
  X1 = X_labeled[, 1],
  X2 = X_labeled[, 2]
)
fit_lm <- lm(Y ~ X1 + X2, data = df_labeled)

## Coefficients from naive OLS based on labeled data
summary(fit_lm)$coefficients

## Prediction for new covariate values
X_new <- data.frame(X1=rnorm(5), X2=rnorm(5))
predict(fit_lm, newdata = X_new)
predict(fit_sada, newdata = X_new)
```
